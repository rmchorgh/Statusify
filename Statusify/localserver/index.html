<!DOCTYPE html>
<html>
	<head>
		<title>Spotify Web API</title>
	</head>
	<body>
		<div class="container">
			<h1>Get your API Key</h1>
			<p>Log in with your Spotify account to get your API key.</p>
			<button class="btn btn-primary" id="btn-login">Login</button>
		</div>
		<script>
			const loginURL = (scopes) => {
				const CLIENT_ID = '6c5f5abb92cd4cb8b659040e934e7aa5';
				const REDIRECT_URI = 'http://localhost:3000';
				return (
					'https://accounts.spotify.com/authorize?client_id=' +
					CLIENT_ID +
					'&redirect_uri=' +
					encodeURIComponent(REDIRECT_URI) +
					'&scope=' +
					encodeURIComponent(scopes.join(' ')) +
					'&response_type=token'
				);
			};

			const login = () => {

				const url = loginURL([
					'user-modify-playback-state',
					'user-read-currently-playing'
				]);

				var width = 450,
					height = 730,
					left = screen.width / 2 - width / 2,
					top = screen.height / 2 - height / 2;

				window.addEventListener(
					'message',
					async ({ data }) => {
						const { type } = JSON.parse(data);
						if (type == 'access_token') {
                            await fetch(`${CLIENT_ID}/token`, {
								method: 'POST',
								body: token
							});
						}
					},
					false
				);

				var w = window.open(
					url,
					'Spotify',
					'menubar=no,location=no,resizable=no,scrollbars=no,status=no, width=' +
						width +
						', height=' +
						height +
						', top=' +
						top +
						', left=' +
						left
				);
			};

			const loginButton = document.getElementById('btn-login');
			loginButton.addEventListener('click', login);
		</script>

	</body>
</html>
